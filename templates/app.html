<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ShareLite - Local Share</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" href="data:,">
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <a class="brand-link" href="{{ url_for('index') }}">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="ShareLite" class="logo-img">
        <span class="name">ShareLite</span>
      </a>
    </div>
    <div class="header-right">
      <button id="navToggle" class="btn icon-btn" aria-label="Menu" aria-controls="mainNav" aria-expanded="false">
        <i class="fa-solid fa-bars" aria-hidden="true"></i>
      </button>
      <nav class="nav" id="mainNav">
        <a href="{{ url_for('index') }}" class="nav-home"><i class="fa-solid fa-house" aria-hidden="true"></i> Home</a>
        <a href="{{ url_for('sender_page') }}" class="nav-send"><i class="fa-solid fa-upload" aria-hidden="true"></i> Send</a>
        <a href="{{ url_for('receiver_page') }}" class="nav-receive"><i class="fa-solid fa-download" aria-hidden="true"></i> Receive</a>
        <a href="{{ url_for('about_page') }}" class="nav-about"><i class="fa-solid fa-circle-info" aria-hidden="true"></i> About</a>
      </nav>
    </div>
  </header>

  <main class="container">
    {% if page == 'index' %}
    <section class="hero">
      <h1>Fast local file sharing</h1>
      <p>Send files to nearby devices connected to the same Wi‑Fi / LAN.</p>
      <div class="cta">
        <a class="btn btn-primary" href="{{ url_for('sender_page') }}"><i class="fa-solid fa-upload" aria-hidden="true"></i> Send</a>
        <a class="btn btn-secondary" href="{{ url_for('receiver_page') }}"><i class="fa-solid fa-download" aria-hidden="true"></i> Receive</a>
      </div>
    </section>

    <section class="card qr-card">
      <div>
        <h2>How to use ShareLite</h2>
        <ol>
          <li>Open the <strong>Send</strong> page on the machine that has the files.</li>
          <li>Click <strong>New Session</strong>, select files and start the upload.</li>
          <li>On the receiving device, open the <strong>Receive</strong> page and scan the QR code or enter the session code.</li>
          <li>Download the files — no internet or cloud required.</li>
          <li>Keep both devices on the same Wi‑Fi/LAN and ensure the sender stays awake/unlocked during transfer.</li>
        </ol>
      </div>
      <div>
        {% set selected_ip = ip_candidates[0] if ip_candidates else request.host.split(':')[0] %}
        {% set port = request.environ.get('SERVER_PORT', '5000') %}
        {% set share_url = ('http://' ~ selected_ip ~ ':' ~ port) %}
        <h2>Quick Scan</h2>
        <p class="muted">Scan this from the receiver device to open ShareLite on the sender machine.</p>
        <div class="qr-grid">
          <div class="qr-item">
            <img src="{{ url_for('api_qr_png') }}?text={{ share_url | urlencode }}&size=256" alt="QR: {{ share_url }}">
          </div>
        </div>
        <p class="qr-address"><strong>Address:</strong> <code>{{ share_url }}</code></p>
      </div>
    </section>
    {% elif page == 'sender' %}
    <!-- provide max size to JS via data attribute -->
    <div data-bytes="{{ max_file_size }}"></div>

    <div class="container send-page initial" id="sendPage">
      <!-- single-column sender UI (shown after session creation) -->
      <div id="senderGrid" class="hidden">
        <div class="card send-area">
          <div class="session-header">
            <h2>Your Session Code</h2>
            <div class="session-code-wrap">
              <div id="sessionCodePanel" class="session-code"></div>
              <button class="copy-btn copy-session-btn" data-copy-session="sessionCodePanel" aria-label="Copy session code">
                <i class="fa-regular fa-copy" aria-hidden="true"></i>
              </button>
            </div>
          </div>

          <div class="dropzone" id="dropzone">
            <input type="file" id="fileInput" multiple>
            <div class="drop-inner">
              <i class="fa-solid fa-cloud-arrow-up drop-icon"></i>
              <div class="drop-text">Click or drag files here</div>
              <div class="muted">Max size per file: <span id="maxSize"></span></div>
            </div>
          </div>

          <div id="selectedFiles" class="selected-files"></div>

          <div class="uploader-actions">
            <button id="uploadBtn" class="btn btn-primary" disabled>
              <i class="fa-solid fa-upload"></i> Upload Files
            </button>
            <button id="clearBtn" class="btn btn-secondary">
              <i class="fa-solid fa-trash"></i> Clear Selection
            </button>
          </div>

          <div class="progress">
            <div id="uploadProgress" class="progress-bar" style="width:0%">0%</div>
          </div>
          <div id="uploadStatus" class="muted"></div>
        </div>
      </div>
    </div>
    {% elif page == 'receiver' %}
    <div class="container receive-page initial" id="receivePage">
      <div class="card main-hero">
        <h1 class="text-center">Receive Files</h1>
        <p class="muted text-center">Enter the 6-character session code shared by the sender to start receiving files.</p>
        
        <div class="receiver-form">
          <!-- inline input + button -->
          <div class="form-row row-inline">
            <label for="sessionInput" class="visually-hidden">Session Code</label>
            <input 
              type="text" 
              id="sessionInput" 
              placeholder="ABC123" 
              value="{{ session_prefill }}" 
              autocomplete="off"
              maxlength="6"
              aria-label="Enter session code"
            >
            <button id="connectBtn" class="btn btn-primary">
              <i class="fa-solid fa-link"></i> Connect
            </button>
          </div>

          <!-- helper + examples on same row -->
          <div class="form-row helpers-row">
            <div class="input-helper">Ask the sender for the session code</div>
            <div class="code-examples">
              <span class="code-example">Example: ABC123</span>
              <span class="code-example">Format: 6 chars</span>
            </div>
          </div>
        </div>
      </div>

      <div id="receiverGrid" class="hidden">
        <div class="card receiver-grid-card">
          <div class="receiver-top">
            <div class="session-header">
              <h2>Session</h2>
              <div class="session-code-wrap">
                <div id="sessionCodePanelR" class="session-code"></div>
                <button class="copy-btn copy-session-btn" data-copy-session="sessionCodePanelR" aria-label="Copy session code">
                  <i class="fa-regular fa-copy" aria-hidden="true"></i>
                </button>
              </div>
            </div>

            <div class="receiver-actions">
              <button id="refreshBtn" class="btn btn-sm"><i class="fa-solid fa-arrows-rotate"></i> Refresh</button>
              <button id="leaveSessionBtn" class="btn btn-sm"><i class="fa-solid fa-door-open"></i> Leave</button>
            </div>
          </div>

          <div class="receiver-columns">
            <section class="files-column">
              <h3><i class="fa-solid fa-folder-open"></i> Available Files</h3>
              <div id="filesList" class="files-list"></div>
              <div class="download-actions">
                <button id="downloadSelectedBtn" class="btn btn-secondary" disabled>
                  <i class="fa-solid fa-cloud-arrow-down"></i> Download Selected
                </button>
              </div>
            </section>

            <aside class="details-column">
              <h3><i class="fa-solid fa-eye"></i> Preview</h3>
              <div id="filePreview" class="file-preview">
                <i class="fa-solid fa-folder-open file-preview-icon"></i>
                <div class="muted">Select a file to preview</div>
              </div>
              
              <div class="details-progress">
                <div class="progress-label" style="display:none;">
                  <i class="fa-solid fa-spinner"></i>
                  <span>Progress</span>
                </div>
                <div class="progress">
                  <div id="downloadProgress" class="progress-bar" style="width:0%">0%</div>
                </div>
                <div id="downloadStatus" class="muted"></div>
              </div>
            </aside>
          </div>
        </div>
      </div>
    </div>
    {% elif page == 'about' %}
    <section class="about-hero">
      <div class="about-inner container card">
        <div class="about-main">
          <h1>ShareLite</h1>
          <p class="lead">Fast, private local file sharing. No cloud, no fuss — just a simple web UI to transfer files across devices on the same LAN.</p>

          <div class="about-cta">
            <a class="btn btn-primary" href="{{ url_for('sender_page') }}"><i class="fa-solid fa-upload"></i> Start Sending</a>
            <a class="btn" href="https://github.com/" target="_blank" rel="noopener"><i class="fa-brands fa-github"></i> View on GitHub</a>
          </div>

          <div class="features-grid" aria-hidden="false">
            <article class="feature-card">
              <div class="feature-icon"><i class="fa-solid fa-shield-halved"></i></div>
              <h3>Private & Local</h3>
              <p>Files stay on your machine and transfer over your LAN only.</p>
            </article>

            <article class="feature-card">
              <div class="feature-icon"><i class="fa-solid fa-bolt"></i></div>
              <h3>Fast Transfers</h3>
              <p>Lightweight server and direct downloads keep speeds high.</p>
            </article>

            <article class="feature-card">
              <div class="feature-icon"><i class="fa-solid fa-user-check"></i></div>
              <h3>Simple Workflow</h3>
              <p>Create a session, upload files, receivers enter the code — done.</p>
            </article>

            <article class="feature-card">
              <div class="feature-icon"><i class="fa-solid fa-lock-open"></i></div>
              <h3>No Account Required</h3>
              <p>No signups, no cloud storage — ephemeral sessions with automatic cleanup.</p>
            </article>
          </div>
        </div>

        <aside class="about-side">
          <div class="meta-card">
            <h4>Quick Facts</h4>
            <div class="meta-row"><span>Version</span><strong>development</strong></div>
            <div class="meta-row"><span>Session TTL</span><strong>{{ (session_ttl_seconds // 60) }} min</strong></div>
            <div class="meta-row"><span>Max file</span><strong>{{ (max_file_size // (1024*1024*1024)) }} GB</strong></div>
          </div>

          <div class="meta-card small">
            <h4>Get help</h4>
            <p class="muted">Report issues or request features on the project repository.</p>
            <p><a class="btn btn-secondary" href="https://github.com/" target="_blank" rel="noopener"><i class="fa-brands fa-github"></i> Open GitHub</a></p>
          </div>
        </aside>
      </div>
    </section>
    {% elif page == '404' %}
    <section class="card">
      <h2>Not Found</h2>
      <p>The resource you requested does not exist.</p>
      <p><a class="btn" href="{{ url_for('index') }}">Back to Home</a></p>
    </section>
    {% endif %}
  </main>

  <footer class="app-footer">
    <div class="footer-inner">
      <div class="footer-line footer-links">
        <a href="{{ url_for('index') }}"><i class="fa-solid fa-house" aria-hidden="true"></i><span>Home</span></a><span class="sep">·</span>
        <a href="{{ url_for('sender_page') }}"><i class="fa-solid fa-upload" aria-hidden="true"></i><span>Send</span></a><span class="sep">·</span>
        <a href="{{ url_for('receiver_page') }}"><i class="fa-solid fa-download" aria-hidden="true"></i><span>Receive</span></a><span class="sep">·</span>
        <a href="{{ url_for('about_page') }}"><i class="fa-solid fa-circle-info" aria-hidden="true"></i><span>About</span></a><span class="sep">·</span>
        <a href="https://github.com/" target="_blank" rel="noopener"><i class="fa-brands fa-github" aria-hidden="true"></i><span>GitHub</span></a>
      </div>
      <div class="footer-line footer-quote muted">
        ShareLite - Fast, private transfers on your local network. Made with ❤️
      </div>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html>